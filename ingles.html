<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TrainingBook â€¢ InglÃªs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0c10;            /* fundo escuro elegante */
      --panel:rgba(255,255,255,.08);
      --glass:rgba(255,255,255,.10);
      --txt:#e6e6e6;
      --muted:#a9acb6;
      --acc:#4da3ff;           /* acento sutil (azulado Apple-like) */
      --ok:#2ecc71; --warn:#f1c40f; --bad:#e74c3c;
      --radius:18px; --radius-lg:28px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto; background:radial-gradient(1200px 1200px at 120% -10%, #1a2030 0%, #0b0c10 45%), #0b0c10; color:var(--txt);}
    .app{min-height:100%; display:grid; grid-template-rows:auto 1fr;}

    /* Top bar */
    header{position:sticky; top:0; backdrop-filter:saturate(180%) blur(14px); background:linear-gradient(180deg, rgba(15,16,25,.78), rgba(15,16,25,.52)); border-bottom:1px solid rgba(255,255,255,.06); z-index:50}
    .bar{max-width:1100px; margin:auto; display:flex; gap:14px; align-items:center; padding:14px 20px}
    .logo{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px}
    .logo i{width:30px;height:30px; border-radius:10px; background:linear-gradient(135deg,#8ab6ff, #a88bff 60%, #ffffff40); box-shadow:0 10px 24px #8ab6ff20 inset, 0 -10px 24px #a88bff20 inset, var(--shadow)}
    .pill{display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:var(--panel); border:1px solid rgba(255,255,255,.06)}
    .pill input{all:unset; color:var(--txt)}
    .right{margin-left:auto; display:flex; gap:10px; align-items:center}
    .btn{cursor:pointer; user-select:none; padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); box-shadow:var(--shadow); transition:.2s transform, .2s filter, .2s background}
    .btn:hover{transform:translateY(-1px);}
    .btn.primary{background:linear-gradient(180deg, #4da3ff55, #4da3ff26); border-color:#4da3ff55}

    /* Layout */
    .wrap{max-width:1100px; margin:24px auto 80px; padding:0 18px; display:grid; grid-template-columns:320px 1fr; gap:22px}

    /* Cover / Metadata */
    .cover{position:relative; border-radius:var(--radius-lg); padding:18px; background:var(--glass); border:1px solid rgba(255,255,255,.10); overflow:hidden}
    .cover::before{content:""; position:absolute; inset:-25%; filter:blur(40px); background:radial-gradient(600px 600px at 10% 0%, #4da3ff33, transparent 60%), radial-gradient(600px 600px at 90% 110%, #a88bff33, transparent 60%);} 
    .cover .img{aspect-ratio:1/1; border-radius:22px; background:linear-gradient(135deg,#a88bff33,#4da3ff33); border:1px solid rgba(255,255,255,.12); display:grid; place-items:center; overflow:hidden}
    .cover .img svg{opacity:.9}
    .meta{margin-top:14px; display:grid; gap:10px}
    .meta h1{margin:0; font-size:22px}
    .badge{font-size:12px; color:#cbd3e9; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); width:max-content}

    /* Panels */
    .panel{border-radius:var(--radius); background:var(--glass); border:1px solid rgba(255,255,255,.10); padding:16px; backdrop-filter: blur(14px) saturate(140%);}
    .stack{display:grid; gap:12px}

    /* Lesson list */
    .lessons{display:grid; gap:12px}
    .lesson{border-radius:18px; padding:14px; border:1px solid rgba(255,255,255,.10); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); display:grid; gap:10px}
    .lesson header{position:relative; inset:auto; background:transparent; border:none; padding:0}
    .lesson h3{margin:0 0 6px 0}
    .tags{display:flex; flex-wrap:wrap; gap:8px}
    .tag{font-size:12px; padding:6px 8px; border-radius:10px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.06)}

    /* Vocab table */
    table.vocab{width:100%; border-collapse:separate; border-spacing:0 8px}
    table.vocab th, table.vocab td{padding:10px 12px; text-align:left}
    table.vocab thead th{font-size:12px; color:var(--muted); font-weight:600}
    table.vocab tbody tr{background:rgba(255,255,255,.04)}
    table.vocab tbody td:first-child{border-radius:12px 0 0 12px}
    table.vocab tbody td:last-child{border-radius:0 12px 12px 0}
    .ipa{font-family:"Times New Roman", serif; font-style:italic; opacity:.9}
    .speak{cursor:pointer; border:none; background:transparent; padding:6px 10px; border-radius:10px}
    .speak:hover{background:rgba(255,255,255,.08)}

    /* Player */
    .player{display:flex; align-items:center; gap:10px; padding:10px; border-radius:12px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10)}
    .player input[type="file"]{display:none}
    .small{font-size:12px; color:var(--muted)}

    /* Footer */
    footer{max-width:1100px; margin:40px auto; padding:0 18px 50px; color:var(--muted); font-size:12px}

    /* Mobile */
    @media (max-width:920px){ .wrap{grid-template-columns:1fr} .bar{padding:12px} }
  </style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="bar">
      <div class="logo"><i></i> TrainingBook <span class="badge">v1</span></div>
      <div class="pill" role="search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/></svg>
        <input id="q" placeholder="Buscar palavra, frase ou liÃ§Ã£o" />
      </div>
      <div class="right">
        <button class="btn" id="toggle-ipa" title="Mostrar/ocultar pronÃºncia">/IPA/</button>
        <button class="btn primary" id="add-lesson">+ LiÃ§Ã£o</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Left: Cover / Meta / Controls -->
    <aside class="stack">
      <section class="cover">
        <div class="img" aria-label="Capa do livro">
          <!-- Capa minimalista -->
          <svg width="140" height="140" viewBox="0 0 200 200" role="img" aria-label="Ãcone do livro">
            <defs>
              <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#9ec5ff"/><stop offset="100%" stop-color="#a88bff"/></linearGradient>
            </defs>
            <rect x="20" y="35" width="160" height="130" rx="16" fill="url(#g1)" opacity=".25"/>
            <rect x="28" y="45" width="144" height="110" rx="12" stroke="#bcd4ff" fill="#ffffff18"/>
            <path d="M58 72h84M58 92h84M58 112h64" stroke="#ffffffaa" stroke-width="6" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="meta">
          <h1>Livro de Treino â€“ InglÃªs</h1>
          <div class="small">Design Appleâ€‘like + efeito glass. Offline, rÃ¡pido e editÃ¡vel.</div>
          <div class="player">
            <button class="btn" id="btn-master-play">â–¶ï¸</button>
            <div>
              <div class="small">Ãudio geral da liÃ§Ã£o (URL ou arquivo)</div>
              <input id="master-audio-url" placeholder="https://exemplo.com/lesson01.mp3" style="width:100%; padding:8px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--txt)"/>
              <label class="btn" style="margin-top:8px" for="master-audio-file">Carregar MP3</label>
              <input id="master-audio-file" type="file" accept="audio/*" />
            </div>
          </div>
          <div class="small">Progresso salvo automaticamente no seu dispositivo (localStorage).</div>
        </div>
      </section>

      <section class="panel stack">
        <strong>Adicionar conteÃºdo</strong>
        <div class="small">Cole abaixo um objeto JSON seguindo o <em>schema</em> â†’ clique em â€œImportarâ€.</div>
        <textarea id="json-input" rows="10" style="width:100%; border-radius:14px; padding:12px; background:rgba(255,255,255,.06); color:var(--txt); border:1px solid rgba(255,255,255,.12)"></textarea>
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn" id="btn-import">Importar</button>
          <button class="btn" id="btn-export">Exportar</button>
          <button class="btn" id="btn-clear">Limpar livro</button>
        </div>
        <details>
          <summary>Ver schema</summary>
<pre style="white-space:pre-wrap; font-size:12px; color:var(--muted)">{
  "meta": {"title":"Livro de Treino", "author":"Michael", "coverNote":"opcional"},
  "lessons": [
    {
      "id":"w2-01",
      "title":"BÃ¡sico: drink & eat",
      "objectives":["Verbos drink/eat", "Frases simples"],
      "audioUrl":"(opcional)",
      "vocab":[
        {"en":"drink","ipa":"/drÉªÅ‹k/","pt":"beber"},
        {"en":"eat","ipa":"/iËt/","pt":"comer"}
      ],
      "phrases":[
        {"en":"I drink water.","pt":"Eu bebo Ã¡gua.","ipa":"aÉª drÉªÅ‹k ËˆwÉ”ËtÉ™(r)"},
        {"en":"I eat bread.","pt":"Eu como pÃ£o.","ipa":"aÉª iËt brÉ›d"}
      ]
    }
  ]
}
</pre>
        </details>
      </section>
    </aside>

    <!-- Right: Lessons viewport -->
    <section class="panel">
      <div class="lessons" id="lessons"></div>
    </section>
  </main>

  <footer>
    <div>Feito para estudos no celular/desktop. Suporte a pronÃºncia (TTS), /IPA/, buscas e Ã¡udio por liÃ§Ã£o/palavra.</div>
    <div style="margin-top:8px">Â© VocÃª. Este arquivo Ã© local e editÃ¡vel. 
      ConteÃºdos exemplificativos de vocabulÃ¡rio bÃ¡sico (â€œdrinkâ€, â€œeatâ€, frases curtas) foram usados apenas para demonstrar estrutura de liÃ§Ãµes. (Fonte de inspiraÃ§Ã£o didÃ¡tica: material W2 â€“ Student. Consulte direitos antes de publicar comercialmente.)
    </div>
  </footer>
</div>

<script>
  // ---------------------------
  // Estado & utilidades
  // ---------------------------
  const $ = sel => document.querySelector(sel);
  const appKey = 'trainingBook.v1';
  const state = JSON.parse(localStorage.getItem(appKey) || '{"meta":{},"lessons":[]}');
  let showIPA = true;

  function save(){ localStorage.setItem(appKey, JSON.stringify(state)); }

  // TTS (pronÃºncia) â€” Web Speech API
  function speak(text, lang='en-US', rate=1){
    try{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = lang; u.rate = rate; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u);
    }catch(e){ console.warn('TTS indisponÃ­vel', e); }
  }

  // RenderizaÃ§Ã£o principal
  function render(){
    const list = $('#lessons');
    const q = ($('#q').value || '').trim().toLowerCase();
    list.innerHTML = '';
    const lessons = (state.lessons||[]).filter(l => !q || JSON.stringify(l).toLowerCase().includes(q));
    if(lessons.length===0){
      list.innerHTML = `<div class="small">Nenhuma liÃ§Ã£o ainda. Importe via JSON ou clique em â€œ+ LiÃ§Ã£oâ€.</div>`;
      return;
    }
    lessons.forEach(lesson => list.appendChild(renderLesson(lesson)));
  }

  function renderLesson(lesson){
    const wrap = document.createElement('article');
    wrap.className = 'lesson';
    wrap.innerHTML = `
      <header>
        <h3>${lesson.title||'LiÃ§Ã£o'}</h3>
        <div class="tags">
          ${(lesson.objectives||[]).map(o=>`<span class="tag">${o}</span>`).join('')}
        </div>
      </header>
      ${renderLessonPlayer(lesson)}
      ${renderVocab(lesson)}
      ${renderPhrases(lesson)}
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px">
        <button class="btn" data-edit="${lesson.id}">Editar</button>
        <button class="btn" data-del="${lesson.id}">Remover</button>
      </div>
    `;

    // aÃ§Ãµes locais
    wrap.addEventListener('click', (ev)=>{
      const t = ev.target;
      if(t.matches('[data-del]')){ removeLesson(t.getAttribute('data-del')); }
      if(t.matches('[data-edit]')){ editLesson(t.getAttribute('data-edit')); }
      if(t.matches('[data-say]')){ speak(t.getAttribute('data-text'), 'en-US', 1); }
    });
    return wrap;
  }

  function renderLessonPlayer(lesson){
    return `
      <div class="player">
        <button class="btn" data-say data-text="${(lesson.title||'Lesson')}" title="TTS da liÃ§Ã£o">â–¶ï¸</button>
        <div style="flex:1">
          <div class="small">Ãudio desta liÃ§Ã£o</div>
          <audio controls preload="metadata" style="width:100%" src="${lesson._objectUrl || lesson.audioUrl || ''}"></audio>
          <div style="display:flex; gap:8px; margin-top:6px; flex-wrap:wrap">
            <input id="file-${lesson.id}" type="file" accept="audio/*" style="display:none" />
            <label class="btn" for="file-${lesson.id}">Carregar MP3</label>
            <input placeholder="ou cole uma URLâ€¦" value="${lesson.audioUrl||''}" data-url="${lesson.id}" style="flex:1; padding:8px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--txt)"/>
          </div>
        </div>
      </div>`;
  }

  function renderVocab(lesson){
    const rows = (lesson.vocab||[]).map(v=>`
      <tr>
        <td style="width:34%"><button class="speak" data-say data-text="${v.en}">ğŸ”Š</button> <strong>${v.en}</strong> <span class="ipa" style="${showIPA?'':'display:none'}"> ${v.ipa?`(${v.ipa})`:''}</span></td>
        <td style="width:33%">${v.pt||''}</td>
        <td>
          <audio controls preload="metadata" style="width:100%" src="${v._objectUrl || v.audioUrl || ''}"></audio>
          <div style="display:flex; gap:6px; margin-top:6px; flex-wrap:wrap">
            <input id="file-${lesson.id}-${v.en}" type="file" accept="audio/*" style="display:none" />
            <label class="btn" for="file-${lesson.id}-${v.en}">MP3</label>
            <input placeholder="URL do Ã¡udio da palavra (opcional)" value="${v.audioUrl||''}" data-vurl="${lesson.id}:${v.en}" style="flex:1; padding:8px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--txt)"/>
          </div>
        </td>
      </tr>`).join('');
    return `
      <details open>
        <summary><strong>VocabulÃ¡rio</strong></summary>
        <table class="vocab">
          <thead><tr><th>InglÃªs</th><th>PortuguÃªs</th><th>Ãudio</th></tr></thead>
          <tbody>${rows || '<tr><td colspan="3" class="small">Sem entradas ainda.</td></tr>'}</tbody>
        </table>
      </details>`;
  }

  function renderPhrases(lesson){
    const items = (lesson.phrases||[]).map(p=>`
      <li style="display:grid; gap:6px; padding:10px; background:rgba(255,255,255,.04); border-radius:12px">
        <div><button class="speak" data-say data-text="${p.en}">ğŸ”Š</button> <strong>${p.en}</strong> <span class="ipa" style="${showIPA?'':'display:none'}">${p.ipa?` (${p.ipa})`:''}</span></div>
        <div class="small">${p.pt||''}</div>
      </li>`).join('');
    return `
      <details open>
        <summary><strong>Frases</strong></summary>
        <ul style="list-style:none; padding:0; display:grid; gap:8px">${items || '<li class="small">Sem frases ainda.</li>'}</ul>
      </details>`;
  }

  // InteraÃ§Ãµes globais
  $('#q').addEventListener('input', render);
  $('#toggle-ipa').addEventListener('click', ()=>{ showIPA=!showIPA; document.querySelectorAll('.ipa').forEach(e=> e.style.display = showIPA?'' : 'none'); });
  $('#add-lesson').addEventListener('click', ()=>{
    const id = 'lesson-' + (Math.random().toString(36).slice(2,8));
    state.lessons.push({ id, title:'Nova liÃ§Ã£o', objectives:[], vocab:[], phrases:[] });
    save(); render();
  });

  // Master audio
  let masterAudio = new Audio();
  $('#btn-master-play').onclick = ()=> masterAudio.paused ? masterAudio.play() : masterAudio.pause();
  $('#master-audio-url').addEventListener('change', e=>{ masterAudio.src = e.target.value; });
  $('#master-audio-file').addEventListener('change', e=>{ const f=e.target.files[0]; if(!f) return; masterAudio.src = URL.createObjectURL(f); });

  // Import/Export/Clear
  $('#btn-import').addEventListener('click', ()=>{
    try{
      const obj = JSON.parse($('#json-input').value);
      if(!obj.lessons) throw new Error('JSON deve conter { lessons: [...] }');
      state.meta = obj.meta||{}; state.lessons = obj.lessons||[]; save(); render(); alert('ConteÃºdo importado.');
    }catch(e){ alert('JSON invÃ¡lido: '+e.message); }
  });
  $('#btn-export').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = Object.assign(document.createElement('a'), {href:url, download:'trainingbook.json'});
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });
  $('#btn-clear').addEventListener('click', ()=>{
    if(confirm('Limpar todo o livro?')){ localStorage.removeItem(appKey); state.meta={}; state.lessons=[]; render(); }
  });

  // Editar / Remover
  function removeLesson(id){
    if(!confirm('Remover esta liÃ§Ã£o?')) return;
    state.lessons = state.lessons.filter(l=>l.id!==id); save(); render();
  }
  function editLesson(id){
    const l = state.lessons.find(x=>x.id===id);
    $('#json-input').value = JSON.stringify(l, null, 2);
    window.scrollTo({top:0, behavior:'smooth'});
  }

  // DelegaÃ§Ã£o para inputs de URL/arquivos de liÃ§Ã£o e vocab
  document.addEventListener('change', (ev)=>{
    const t = ev.target;
    // URL de Ã¡udio da liÃ§Ã£o
    if(t.matches('[data-url]')){
      const id = t.getAttribute('data-url');
      const l = state.lessons.find(x=>x.id===id);
      if(l){ l.audioUrl = t.value; save(); }
    }
    // Arquivo de Ã¡udio da liÃ§Ã£o
    if(t.id.startsWith('file-') && t.type==='file' && t.files && t.files[0]){
      const [_, lid] = t.id.split('file-');
      const l = state.lessons.find(x=>lid.startsWith(x.id));
      if(l){ l._objectUrl && URL.revokeObjectURL(l._objectUrl); l._objectUrl = URL.createObjectURL(t.files[0]); save(); render(); }
    }
    // URL de Ã¡udio de vocabulÃ¡rio
    if(t.matches('[data-vurl]')){
      const [lid, en] = t.getAttribute('data-vurl').split(':');
      const l = state.lessons.find(x=>x.id===lid); if(!l) return;
      const v = (l.vocab||[]).find(w=>w.en===en); if(!v) return;
      v.audioUrl = t.value; save();
    }
  });

  // Demo inicial (pode remover) â€“ inspirado em vocabulÃ¡rio bÃ¡sico
  if(!state.lessons || state.lessons.length===0){
    state.lessons = [
      {
        id:'w2-01',
        title:'BÃ¡sico 01 â€” drink & eat',
        objectives:['Verbos bÃ¡sicos','Frases afirmativas'],'audioUrl':'',
        vocab:[
          {en:'drink', ipa:'/drÉªÅ‹k/', pt:'beber'},
          {en:'eat', ipa:'/iËt/', pt:'comer'},
          {en:'water', ipa:'/ËˆwÉ”ËtÉ™r/', pt:'Ã¡gua'},
          {en:'bread', ipa:'/brÉ›d/', pt:'pÃ£o'},
          {en:'milk', ipa:'/mÉªlk/', pt:'leite'},
        ],
        phrases:[
          {en:'I drink water.', pt:'Eu bebo Ã¡gua.', ipa:'aÉª drÉªÅ‹k ËˆwÉ”ËtÉ™(r)'},
          {en:'I eat bread.', pt:'Eu como pÃ£o.', ipa:'aÉª iËt brÉ›d'},
          {en:'I drink milk and you drink coffee.', pt:'Eu bebo leite e vocÃª bebe cafÃ©.', ipa:'aÉª drÉªÅ‹k mÉªlk Ã¦nd juË drÉªÅ‹k ËˆkÉ’fi'}
        ]
      },
      {
        id:'w2-02',
        title:'BÃ¡sico 02 â€” speak & study',
        objectives:['PrÃ¡tica com â€œspeak/studyâ€','Perguntas simples'],
        vocab:[
          {en:'speak', ipa:'/spiËk/', pt:'falar'},
          {en:'study', ipa:'/ËˆstÊŒdi/', pt:'estudar'},
          {en:'English', ipa:'/ËˆÉªÅ‹É¡lÉªÊƒ/', pt:'inglÃªs'},
          {en:'Portuguese', ipa:'/ËˆpÉ”ËtÊƒÉ™ËŒÉ¡iËz/', pt:'portuguÃªs'}
        ],
        phrases:[
          {en:'I speak English.', pt:'Eu falo inglÃªs.', ipa:'aÉª spiËk ËˆÉªÅ‹É¡lÉªÊƒ'},
          {en:'Do you study at home?', pt:'VocÃª estuda em casa?', ipa:'duË juË ËˆstÊŒdi Ã¦t hoÊŠm?'}
        ]
      }
    ];
    save();
  }

  // Inicializa
  render();
</script>
</body>
</html>
